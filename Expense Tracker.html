<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monthly Expense Tracker</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <!-- Custom Styles -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #f0f4f8;
        }
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .animate-fade-in {
            animation: fadeIn 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Blob Animation */
        @keyframes blob {
            0% { transform: translate(0px, 0px) scale(1); }
            33% { transform: translate(30px, -50px) scale(1.1); }
            66% { transform: translate(-20px, 20px) scale(0.9); }
            100% { transform: translate(0px, 0px) scale(1); }
        }
        .animate-blob {
            animation: blob 7s infinite;
        }
        .animation-delay-2000 {
            animation-delay: 2s;
        }
        .animation-delay-4000 {
            animation-delay: 4s;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.05);
        }
        .glass-input {
            background: rgba(255, 255, 255, 0.5);
            backdrop-filter: blur(4px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
    </style>
</head>
<body class="text-slate-800 relative overflow-x-hidden min-h-screen">

    <!-- Dynamic Background Blobs -->
    <div class="fixed inset-0 -z-10 overflow-hidden pointer-events-none">
        <div class="absolute top-0 left-1/4 w-96 h-96 bg-purple-300 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob"></div>
        <div class="absolute top-0 right-1/4 w-96 h-96 bg-yellow-300 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-2000"></div>
        <div class="absolute -bottom-32 left-1/3 w-96 h-96 bg-pink-300 rounded-full mix-blend-multiply filter blur-3xl opacity-30 animate-blob animation-delay-4000"></div>
        <div class="absolute inset-0 bg-white/40 backdrop-blur-[2px]"></div> 
    </div>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- Icons ---
        const IconBase = ({ children, size = 20, className = "", ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>
                {children}
            </svg>
        );

        const LayoutDashboard = (props) => <IconBase {...props}><rect width="7" height="9" x="3" y="3" rx="1" /><rect width="7" height="5" x="14" y="3" rx="1" /><rect width="7" height="9" x="14" y="12" rx="1" /><rect width="7" height="5" x="3" y="16" rx="1" /></IconBase>;
        const PlusCircle = (props) => <IconBase {...props}><circle cx="12" cy="12" r="10" /><path d="M8 12h8" /><path d="M12 8v8" /></IconBase>;
        const Wallet = (props) => <IconBase {...props}><path d="M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1" /><path d="M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4" /></IconBase>;
        const Utensils = (props) => <IconBase {...props}><path d="M3 2v7c0 1.1.9 2 2 2h4a2 2 0 0 0 2-2V2" /><path d="M7 2v20" /><path d="M21 15V2v0a5 5 0 0 0-5 5v6c0 1.1.9 2 2 2h3Zm0 0v7" /></IconBase>;
        const Car = (props) => <IconBase {...props}><path d="M19 17h2c.6 0 1-.4 1-1v-3c0-.9-.7-1.7-1.5-1.9C18.7 10.6 16 10 16 10s-1.3-1.4-2.2-2.3c-.5-.4-1.1-.7-1.8-.7H5c-.6 0-1.1.4-1.4.9l-1.4 2.9A3.7 3.7 0 0 0 2 12v4c0 .6.4 1 1 1h2" /><circle cx="7" cy="17" r="2" /><path d="M9 17h6" /><circle cx="17" cy="17" r="2" /></IconBase>;
        const Coffee = (props) => <IconBase {...props}><path d="M10 2v2" /><path d="M14 2v2" /><path d="M6 2v2" /><path d="M18 8a2.5 2.5 0 0 1 0 5l-1-1v-3h1z" /><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z" /><path d="M6 1h12" /></IconBase>;
        const Apple = (props) => <IconBase {...props}><path d="M12 20.94c1.5 0 2.75 1.06 4 1.06 3 0 6-8 6-12.22A4.91 4.91 0 0 0 17 5c-2.22 0-4 1.44-5 2-1-.56-2.78-2-5-2a4.9 4.9 0 0 0-5 4.78C2 14 5 22 8 22c1.25 0 2.5-1.06 4-1.06Z" /><path d="M10 2c1 .5 2 2 2 5" /></IconBase>;
        const ShoppingBag = (props) => <IconBase {...props}><path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z" /><path d="M3 6h18" /><path d="M16 10a4 4 0 0 1-8 0" /></IconBase>;
        const BookOpen = (props) => <IconBase {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" /><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" /></IconBase>;
        const Home = (props) => <IconBase {...props}><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" /><polyline points="9 22 9 12 15 12 15 22" /></IconBase>;
        const Layers = (props) => <IconBase {...props}><path d="m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z" /><path d="m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65" /><path d="m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65" /></IconBase>;
        const Trash2 = (props) => <IconBase {...props}><path d="M3 6h18" /><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" /><path d="M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /><line x1="10" x2="10" y1="11" y2="17" /><line x1="14" x2="14" y1="11" y2="17" /></IconBase>;
        const Filter = (props) => <IconBase {...props}><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3" /></IconBase>;
        const Search = (props) => <IconBase {...props}><circle cx="11" cy="11" r="8" /><path d="m21 21-4.3-4.3" /></IconBase>;
        const TrendingUp = (props) => <IconBase {...props}><polyline points="22 7 13.5 15.5 8.5 10.5 2 17" /><polyline points="16 7 22 7 22 13" /></IconBase>;
        const CalendarIcon = (props) => <IconBase {...props}><rect width="18" height="18" x="3" y="4" rx="2" ry="2" /><line x1="16" x2="16" y1="2" y2="6" /><line x1="8" x2="8" y1="2" y2="6" /><line x1="3" x2="21" y1="10" y2="10" /></IconBase>;
        const CalendarRange = (props) => <IconBase {...props}><rect width="18" height="18" x="3" y="4" rx="2" ry="2" /><line x1="16" x2="16" y1="2" y2="6" /><line x1="8" x2="8" y1="2" y2="6" /><line x1="3" x2="21" y1="10" y2="10" /><path d="M17 14h-6" /><path d="M13 18H7" /><path d="M7 14h.01" /><path d="M17 18h.01" /></IconBase>;
        const List = (props) => <IconBase {...props}><line x1="8" x2="21" y1="6" y2="6" /><line x1="8" x2="21" y1="12" y2="12" /><line x1="8" x2="21" y1="18" y2="18" /><line x1="3" x2="3.01" y1="6" y2="6" /><line x1="3" x2="3.01" y1="12" y2="12" /><line x1="3" x2="3.01" y1="18" y2="18" /></IconBase>;
        const PieChart = (props) => <IconBase {...props}><path d="M21.21 15.89A10 10 0 1 1 8 2.83" /><path d="M22 12A10 10 0 0 0 12 2v10z" /></IconBase>;
        const Check = (props) => <IconBase {...props}><polyline points="20 6 9 17 4 12" /></IconBase>;
        const Edit2 = (props) => <IconBase {...props}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" /></IconBase>;
        const DollarSign = (props) => <IconBase {...props}><line x1="12" x2="12" y1="1" y2="23" /><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6" /></IconBase>;
        const CreditCard = (props) => <IconBase {...props}><rect width="22" height="16" x="1" y="4" rx="2" ry="2" /><line x1="1" x2="23" y1="10" y2="10" /></IconBase>;
        const ArrowUpDown = (props) => <IconBase {...props}><path d="m21 16-4 4-4-4" /><path d="M17 20V4" /><path d="m3 8 4-4 4 4" /><path d="M7 4v16" /></IconBase>;
        const X = (props) => <IconBase {...props}><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></IconBase>;

        // --- Configuration ---
        const CATEGORIES = {
          'Food': { icon: Utensils, color: 'bg-orange-100 text-orange-600', bar: 'bg-gradient-to-r from-orange-400 to-orange-500' },
          'Transportation': { icon: Car, color: 'bg-blue-100 text-blue-600', bar: 'bg-gradient-to-r from-blue-400 to-blue-500' },
          'Snacks': { icon: Coffee, color: 'bg-amber-100 text-amber-600', bar: 'bg-gradient-to-r from-amber-400 to-amber-500' },
          'Fruits & Veggies': { icon: Apple, color: 'bg-emerald-100 text-emerald-600', bar: 'bg-gradient-to-r from-emerald-400 to-emerald-500' },
          'Provisions': { icon: ShoppingBag, color: 'bg-purple-100 text-purple-600', bar: 'bg-gradient-to-r from-purple-400 to-purple-500' },
          'Books & Stationery': { icon: BookOpen, color: 'bg-indigo-100 text-indigo-600', bar: 'bg-gradient-to-r from-indigo-400 to-indigo-500' },
          'Housing': { icon: Home, color: 'bg-rose-100 text-rose-600', bar: 'bg-gradient-to-r from-rose-400 to-rose-500' },
          'Miscellaneous': { icon: Layers, color: 'bg-slate-100 text-slate-600', bar: 'bg-gradient-to-r from-slate-400 to-slate-500' },
        };

        // --- Helpers ---
        const formatCurrency = (amount) => {
          return new Intl.NumberFormat('en-IN', {
            style: 'currency',
            currency: 'INR',
            maximumFractionDigits: 0
          }).format(amount);
        };

        // --- Components ---
        const StatCard = ({ title, value, note, icon: Icon, action, colorClass = "text-indigo-600", valueColorClass = "text-slate-800" }) => (
          <div className="glass-card p-6 rounded-3xl flex flex-col justify-between h-36 hover:shadow-xl transition-all duration-300 hover:-translate-y-1 group relative overflow-hidden">
             <div className="absolute -top-10 -right-10 w-24 h-24 bg-gradient-to-br from-white/40 to-transparent rounded-full blur-xl group-hover:scale-150 transition-transform duration-500"></div>
             
            <div className="flex justify-between items-start relative z-10">
                <h3 className="text-xs font-bold text-slate-500 uppercase tracking-widest">{title}</h3>
                <div className={`p-2.5 bg-white/80 rounded-xl shadow-sm ${colorClass} group-hover:scale-110 transition-all`}>
                    <Icon size={22} />
                </div>
            </div>
            <div className="relative z-10 flex items-end justify-between">
                <div className="flex-1 min-w-0 mr-2">
                    <p className={`text-2xl font-black tracking-tight truncate ${valueColorClass}`}>{value}</p>
                    <div className="h-1 w-12 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full mt-3 opacity-80 group-hover:w-20 transition-all duration-500"></div>
                    {note && <p className="text-[10px] font-bold text-slate-400 mt-1.5 truncate">{note}</p>}
                </div>
                {action}
            </div>
          </div>
        );

        const CategoryBar = ({ category, amount, total, config }) => {
          const percentage = total > 0 ? (amount / total) * 100 : 0;
          const Icon = config.icon;

          return (
            <div className="flex items-center space-x-4 py-3.5 group px-2 hover:bg-white/40 rounded-xl transition-colors">
              <div className={`p-3 rounded-2xl ${config.color} shadow-sm ring-1 ring-black/5 group-hover:scale-105 transition-transform`}>
                <Icon size={18} />
              </div>
              <div className="flex-1 min-w-0">
                <div className="flex justify-between mb-2 items-end">
                  <span className="text-sm font-bold text-slate-700 group-hover:text-indigo-900 transition-colors">{category}</span>
                  <span className="text-sm font-bold text-slate-900 tabular-nums bg-white/60 px-2 py-0.5 rounded-md shadow-sm">{formatCurrency(amount)}</span>
                </div>
                <div className="w-full bg-slate-100/80 rounded-full h-2.5 overflow-hidden shadow-inner">
                  <div 
                    className={`h-full rounded-full ${config.bar} relative overflow-hidden`} 
                    style={{ width: `${percentage}%`, transition: 'width 1s cubic-bezier(0.4, 0, 0.2, 1)' }}
                  >
                     <div className="absolute top-0 left-0 w-full h-full bg-white/20 animate-pulse"></div>
                  </div>
                </div>
              </div>
            </div>
          );
        };

        const PeriodSelector = ({ viewMode, setViewMode, selectedMonth, setSelectedMonth, dateRange, setDateRange }) => {
          return (
            <div className="flex flex-col sm:flex-row items-end sm:items-center gap-3">
              <div className="bg-white/60 backdrop-blur-md p-1.5 rounded-2xl flex shadow-sm ring-1 ring-black/5">
                <button
                  onClick={() => setViewMode('month')}
                  className={`px-4 py-2 text-xs font-bold rounded-xl transition-all duration-300 ${
                    viewMode === 'month' 
                      ? 'bg-gradient-to-br from-indigo-600 to-indigo-700 text-white shadow-lg shadow-indigo-500/30' 
                      : 'text-slate-500 hover:text-indigo-600 hover:bg-white/50'
                  }`}
                >
                  Monthly
                </button>
                <button
                  onClick={() => setViewMode('range')}
                  className={`px-4 py-2 text-xs font-bold rounded-xl transition-all duration-300 ${
                    viewMode === 'range' 
                      ? 'bg-gradient-to-br from-indigo-600 to-indigo-700 text-white shadow-lg shadow-indigo-500/30' 
                      : 'text-slate-500 hover:text-indigo-600 hover:bg-white/50'
                  }`}
                >
                  Custom
                </button>
              </div>

              {viewMode === 'month' ? (
                <div className="glass-input px-4 py-2 rounded-2xl flex items-center gap-3 h-[44px] shadow-sm ring-1 ring-black/5 hover:bg-white/80 transition-colors group">
                  <CalendarIcon size={16} className="text-indigo-400 group-hover:text-indigo-600 transition-colors"/>
                  <input
                    type="month"
                    value={selectedMonth}
                    onChange={(e) => setSelectedMonth(e.target.value)}
                    className="text-sm font-bold text-slate-700 bg-transparent outline-none cursor-pointer"
                  />
                </div>
              ) : (
                <div className="glass-input px-4 py-2 rounded-2xl flex items-center gap-3 h-[44px] shadow-sm ring-1 ring-black/5 hover:bg-white/80 transition-colors group">
                  <CalendarRange size={16} className="text-indigo-400 group-hover:text-indigo-600 transition-colors"/>
                  <div className="flex items-center gap-2 text-sm">
                    <input
                        type="date"
                        value={dateRange.start}
                        onChange={(e) => setDateRange({...dateRange, start: e.target.value})}
                        className="font-bold text-slate-700 bg-transparent outline-none w-24 sm:w-auto cursor-pointer"
                    />
                    <span className="text-slate-400 text-xs font-medium px-1 bg-slate-100 rounded">to</span>
                    <input
                        type="date"
                        value={dateRange.end}
                        onChange={(e) => setDateRange({...dateRange, end: e.target.value})}
                        className="font-bold text-slate-700 bg-transparent outline-none w-24 sm:w-auto cursor-pointer"
                    />
                  </div>
                </div>
              )}
            </div>
          );
        };

        const MultiSelect = ({ options, selected, onChange }) => {
            const [isOpen, setIsOpen] = useState(false);
            const dropdownRef = useRef(null);

            useEffect(() => {
                const handleClickOutside = (event) => {
                    if (dropdownRef.current && !dropdownRef.current.contains(event.target)) {
                        setIsOpen(false);
                    }
                };
                document.addEventListener("mousedown", handleClickOutside);
                return () => document.removeEventListener("mousedown", handleClickOutside);
            }, []);

            const handleToggle = (option) => {
                if (selected.includes(option)) {
                    onChange(selected.filter(item => item !== option));
                } else {
                    onChange([...selected, option]);
                }
            };

            return (
                <div className="relative w-full md:w-auto" ref={dropdownRef}>
                    <button 
                        onClick={() => setIsOpen(!isOpen)}
                        className="w-full md:w-auto px-5 py-2.5 rounded-2xl glass-input text-sm font-bold text-slate-700 flex items-center justify-between gap-4 shadow-sm ring-1 ring-black/5 hover:bg-white hover:ring-indigo-200 hover:shadow-md transition-all min-w-[180px]"
                    >
                        <span className="truncate max-w-[150px]">
                            {selected.length === 0 
                                ? "All Categories" 
                                : selected.length === 1 
                                    ? selected[0] 
                                    : `${selected.length} Selected`}
                        </span>
                        <div className={`transition-transform duration-300 ${isOpen ? 'rotate-180' : ''}`}>
                            <svg className="w-4 h-4 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M19 9l-7 7-7-7"></path></svg>
                        </div>
                    </button>

                    {isOpen && (
                        <div className="absolute right-0 mt-2 w-72 bg-white border border-slate-200 rounded-2xl shadow-2xl shadow-indigo-500/10 z-50 p-2 max-h-80 overflow-y-auto animate-fade-in ring-1 ring-black/5">
                             <div 
                                onClick={() => { onChange([]); setIsOpen(false); }}
                                className="px-3 py-2.5 hover:bg-indigo-50 rounded-xl cursor-pointer flex items-center justify-between group transition-colors mb-1"
                            >
                                <span className="text-sm font-bold text-slate-700 group-hover:text-indigo-700">All Categories</span>
                                {selected.length === 0 && <div className="bg-indigo-100 p-1 rounded-full"><Check size={14} className="text-indigo-600" strokeWidth={3} /></div>}
                            </div>
                            
                            <div className="h-px bg-slate-100 my-1"></div>
                            
                            {options.map(option => (
                                <div 
                                    key={option}
                                    onClick={() => handleToggle(option)}
                                    className="px-3 py-2.5 hover:bg-white/50 rounded-xl cursor-pointer flex items-center gap-3 group transition-all"
                                >
                                    <div className={`w-5 h-5 rounded-lg border-2 flex items-center justify-center transition-all duration-200 ${selected.includes(option) ? 'bg-indigo-600 border-indigo-600 scale-110 shadow-sm' : 'border-slate-300 bg-white/80 group-hover:border-indigo-300'}`}>
                                        {selected.includes(option) && <Check size={12} className="text-white" strokeWidth={4} />}
                                    </div>
                                    <span className={`text-sm ${selected.includes(option) ? 'font-bold text-indigo-900' : 'font-medium text-slate-600 group-hover:text-slate-800'}`}>{option}</span>
                                </div>
                            ))}
                        </div>
                    )}
                </div>
            );
        };

        // --- Budget Modal Component ---
        const BudgetModal = ({ isOpen, onClose, month, currentBudget, currentNote, onSave }) => {
            const [value, setValue] = useState(currentBudget);
            const [note, setNote] = useState(currentNote);

            useEffect(() => {
                setValue(currentBudget);
                setNote(currentNote);
            }, [currentBudget, currentNote, isOpen]);

            if (!isOpen) return null;

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave(parseFloat(value), note);
                onClose();
            };

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/20 backdrop-blur-sm animate-fade-in">
                    <div className="bg-white rounded-3xl shadow-2xl w-full max-w-sm overflow-hidden relative">
                        <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-green-400 to-emerald-600"></div>
                        <div className="p-8">
                            <h3 className="text-2xl font-black text-slate-800 mb-2">Monthly Income</h3>
                            <p className="text-slate-500 text-sm mb-6">Set your total income details for <span className="font-bold text-emerald-600">{new Date(month).toLocaleDateString('en-US', { month: 'long', year: 'numeric' })}</span>.</p>
                            
                            <form onSubmit={handleSubmit} className="space-y-4">
                                <div className="relative">
                                    <label className="text-xs font-bold text-slate-400 uppercase ml-1 mb-1 block">Amount</label>
                                    <div className="relative">
                                        <span className="absolute left-4 top-3.5 text-emerald-500 font-black text-lg">₹</span>
                                        <input 
                                            type="number" 
                                            required
                                            min="0"
                                            step="0.01"
                                            value={value}
                                            onChange={(e) => setValue(e.target.value)}
                                            className="w-full pl-10 pr-4 py-3.5 rounded-2xl bg-slate-50 border-2 border-transparent focus:bg-white focus:border-emerald-500 focus:ring-0 outline-none transition-all text-lg font-bold text-slate-800"
                                            autoFocus
                                        />
                                    </div>
                                </div>

                                <div>
                                    <label className="text-xs font-bold text-slate-400 uppercase ml-1 mb-1 block">Note <span className="font-normal normal-case opacity-70">(Source, details etc.)</span></label>
                                    <input 
                                        type="text" 
                                        value={note}
                                        onChange={(e) => setNote(e.target.value)}
                                        placeholder="e.g. Salary + Bonus"
                                        className="w-full px-4 py-3.5 rounded-2xl bg-slate-50 border-2 border-transparent focus:bg-white focus:border-emerald-500 focus:ring-0 outline-none transition-all font-medium text-slate-700"
                                    />
                                </div>

                                <div className="flex gap-3 pt-2">
                                    <button type="button" onClick={onClose} className="flex-1 py-3 rounded-xl font-bold text-slate-500 hover:bg-slate-100 transition-colors">Cancel</button>
                                    <button type="submit" className="flex-1 py-3 rounded-xl font-bold text-white bg-emerald-600 hover:bg-emerald-700 shadow-lg shadow-emerald-200 transition-all">Save</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Edit Expense Modal ---
        const EditExpenseModal = ({ isOpen, onClose, expense, onSave }) => {
            const [amount, setAmount] = useState('');
            const [date, setDate] = useState('');
            const [category, setCategory] = useState('');
            const [remarks, setRemarks] = useState('');

            useEffect(() => {
                if (expense) {
                    setAmount(expense.amount);
                    setDate(expense.date);
                    setCategory(expense.category);
                    setRemarks(expense.remarks || '');
                }
            }, [expense, isOpen]);

            if (!isOpen || !expense) return null;

            const handleSubmit = (e) => {
                e.preventDefault();
                onSave({
                    ...expense,
                    amount: parseFloat(amount),
                    date,
                    category,
                    remarks
                });
                onClose();
            };

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-slate-900/30 backdrop-blur-sm animate-fade-in">
                    <div className="bg-white rounded-3xl shadow-2xl w-full max-w-md overflow-hidden relative max-h-[90vh] overflow-y-auto no-scrollbar">
                        <div className="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"></div>
                        
                        {/* Close Button */}
                        <button 
                            onClick={onClose}
                            className="absolute top-4 right-4 p-2 rounded-full hover:bg-slate-100 text-slate-400 hover:text-slate-600 transition-colors"
                        >
                            <X size={20} />
                        </button>

                        <div className="p-8">
                            <h3 className="text-2xl font-black text-slate-800 mb-6 flex items-center gap-3">
                                <div className="bg-indigo-100 p-2 rounded-xl text-indigo-600">
                                    <Edit2 size={20} />
                                </div>
                                Edit Transaction
                            </h3>
                            
                            <form onSubmit={handleSubmit} className="space-y-6">
                                <div className="grid grid-cols-2 gap-4">
                                    <div className="space-y-2">
                                        <label className="text-xs font-bold text-slate-500 uppercase tracking-wider ml-1">Date</label>
                                        <input 
                                            type="date" 
                                            required
                                            value={date}
                                            onChange={(e) => setDate(e.target.value)}
                                            className="w-full px-4 py-3 rounded-xl bg-slate-50 border-2 border-transparent focus:bg-white focus:border-indigo-500 focus:ring-0 outline-none transition-all font-bold text-slate-700"
                                        />
                                    </div>
                                    <div className="space-y-2">
                                        <label className="text-xs font-bold text-slate-500 uppercase tracking-wider ml-1">Amount</label>
                                        <div className="relative">
                                            <span className="absolute left-3 top-3 text-indigo-500 font-black">₹</span>
                                            <input 
                                                type="number" 
                                                required
                                                min="0"
                                                step="0.01"
                                                value={amount}
                                                onChange={(e) => setAmount(e.target.value)}
                                                className="w-full pl-8 pr-4 py-3 rounded-xl bg-slate-50 border-2 border-transparent focus:bg-white focus:border-indigo-500 focus:ring-0 outline-none transition-all font-bold text-slate-800"
                                            />
                                        </div>
                                    </div>
                                </div>

                                <div className="space-y-2">
                                    <label className="text-xs font-bold text-slate-500 uppercase tracking-wider ml-1">Category</label>
                                    <div className="grid grid-cols-2 gap-2">
                                        {Object.keys(CATEGORIES).map((cat) => {
                                            const Icon = CATEGORIES[cat].icon;
                                            const isSelected = category === cat;
                                            return (
                                                <button
                                                    key={cat}
                                                    type="button"
                                                    onClick={() => setCategory(cat)}
                                                    className={`flex items-center gap-2 p-2.5 rounded-xl border-2 transition-all duration-200 ${
                                                        isSelected 
                                                        ? 'bg-indigo-50 border-indigo-500 text-indigo-700' 
                                                        : 'border-transparent bg-slate-50 hover:bg-white hover:border-indigo-200 text-slate-500'
                                                    }`}
                                                >
                                                    <Icon size={18} className={isSelected ? 'stroke-[2.5px]' : ''} />
                                                    <span className="text-xs font-bold truncate">{cat}</span>
                                                </button>
                                            )
                                        })}
                                    </div>
                                </div>

                                <div className="space-y-2">
                                    <label className="text-xs font-bold text-slate-500 uppercase tracking-wider ml-1">Remarks</label>
                                    <textarea 
                                        rows="3"
                                        value={remarks}
                                        onChange={(e) => setRemarks(e.target.value)}
                                        className="w-full px-4 py-3 rounded-xl bg-slate-50 border-2 border-transparent focus:bg-white focus:border-indigo-500 focus:ring-0 outline-none transition-all resize-none font-medium text-slate-600"
                                    ></textarea>
                                </div>

                                <div className="flex gap-3 pt-2">
                                    <button type="button" onClick={onClose} className="flex-1 py-3.5 rounded-xl font-bold text-slate-500 hover:bg-slate-100 transition-colors">Cancel</button>
                                    <button type="submit" className="flex-1 py-3.5 rounded-xl font-bold text-white bg-gradient-to-r from-indigo-600 to-indigo-700 hover:shadow-lg hover:shadow-indigo-500/30 transition-all">Update Transaction</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Main Application ---
        function App() {
          // --- State ---
          const [expenses, setExpenses] = useState(() => {
            try {
                const saved = localStorage.getItem('my-expenses-data');
                return saved ? JSON.parse(saved) : [];
            } catch (e) { return []; }
          });

          const [budgets, setBudgets] = useState(() => {
            try {
                const saved = localStorage.getItem('my-expenses-budgets');
                return saved ? JSON.parse(saved) : {};
            } catch (e) { return {}; }
          });

          const [activeTab, setActiveTab] = useState('dashboard');
          const [filterCategories, setFilterCategories] = useState([]);
          const [isBudgetModalOpen, setIsBudgetModalOpen] = useState(false);
          const [editingTransaction, setEditingTransaction] = useState(null); // New state for editing
          const [sortBy, setSortBy] = useState('date-desc');
          
          const [viewMode, setViewMode] = useState('month');
          const [selectedMonth, setSelectedMonth] = useState(new Date().toISOString().slice(0, 7));
          const [dateRange, setDateRange] = useState({
            start: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
            end: new Date().toISOString().split('T')[0]
          });
          
          const [amount, setAmount] = useState('');
          const [category, setCategory] = useState('Food');
          const [date, setDate] = useState(new Date().toISOString().split('T')[0]);
          const [remarks, setRemarks] = useState('');

          // --- Effects ---
          useEffect(() => {
            try { localStorage.setItem('my-expenses-data', JSON.stringify(expenses)); } catch (e) {}
          }, [expenses]);

          useEffect(() => {
            try { localStorage.setItem('my-expenses-budgets', JSON.stringify(budgets)); } catch (e) {}
          }, [budgets]);

          // --- Derived State ---
          const periodExpenses = useMemo(() => {
            if (viewMode === 'month') {
                return expenses.filter(e => e.date.startsWith(selectedMonth));
            } else {
                const start = dateRange.start;
                const end = dateRange.end;
                return expenses.filter(e => e.date >= start && e.date <= end);
            }
          }, [expenses, viewMode, selectedMonth, dateRange]);

          const totalExpenses = useMemo(() => periodExpenses.reduce((acc, curr) => acc + curr.amount, 0), [periodExpenses]);
          
          const categoryTotals = useMemo(() => {
            const totals = {};
            Object.keys(CATEGORIES).forEach(cat => totals[cat] = 0);
            periodExpenses.forEach(exp => {
              if (totals[exp.category] !== undefined) {
                totals[exp.category] += exp.amount;
              }
            });
            return totals;
          }, [periodExpenses]);

          const filteredHistoryExpenses = useMemo(() => {
            let data = periodExpenses;
            if (filterCategories.length > 0) {
              data = data.filter(e => filterCategories.includes(e.category));
            }
            
            // Sort Logic
            return data.sort((a, b) => {
                switch (sortBy) {
                    case 'date-asc':
                        return new Date(a.date) - new Date(b.date);
                    case 'amount-desc':
                        return b.amount - a.amount;
                    case 'amount-asc':
                        return a.amount - b.amount;
                    case 'date-desc':
                    default:
                        return new Date(b.date) - new Date(a.date);
                }
            });
          }, [periodExpenses, filterCategories, sortBy]);

          const currentMonthlyIncomeData = useMemo(() => {
              const data = budgets[selectedMonth];
              if (!data) return { amount: 0, note: '' };
              // Backward compatibility: if stored as number, convert to object
              if (typeof data === 'number') return { amount: data, note: '' };
              return data;
          }, [budgets, selectedMonth]);

          const currentBalance = currentMonthlyIncomeData.amount - totalExpenses;

          // --- Handlers ---
          const handleAddExpense = (e) => {
            e.preventDefault();
            if (!amount || !date) return;

            const newExpense = {
              id: Date.now(),
              amount: parseFloat(amount),
              category,
              date,
              remarks,
              lastEdited: new Date().toISOString()
            };

            setExpenses([newExpense, ...expenses]);
            setAmount('');
            setRemarks('');
          };

          const handleUpdateExpense = (updatedExpense) => {
              const newExpenses = expenses.map(exp => 
                  exp.id === updatedExpense.id 
                  ? { ...updatedExpense, lastEdited: new Date().toISOString() } 
                  : exp
              );
              setExpenses(newExpenses);
              setEditingTransaction(null);
          };

          const handleDelete = (id) => {
            if (confirm('Are you sure you want to delete this entry?')) {
              setExpenses(expenses.filter(e => e.id !== id));
            }
          };

          const handleSaveBudget = (amount, note) => {
              setBudgets(prev => ({
                  ...prev,
                  [selectedMonth]: { amount, note }
              }));
          };

          // --- Views ---
          const renderDashboard = () => (
            <div className="space-y-8 animate-fade-in max-w-6xl mx-auto">
              <div className="flex flex-col md:flex-row justify-between items-start md:items-center gap-6 border-b border-slate-200/50 pb-8">
                <div>
                    <h2 className="text-4xl font-black text-slate-900 tracking-tight">Overview</h2>
                    <p className="text-slate-500 mt-2 font-medium flex items-center gap-2">
                        <span className="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                        Financial summary for {viewMode === 'month' ? new Date(selectedMonth).toLocaleDateString('en-US', {month: 'long', year: 'numeric'}) : 'selected range'}.
                    </p>
                </div>
                <PeriodSelector 
                    viewMode={viewMode} 
                    setViewMode={setViewMode}
                    selectedMonth={selectedMonth} 
                    setSelectedMonth={setSelectedMonth}
                    dateRange={dateRange}
                    setDateRange={setDateRange}
                />
              </div>

              {/* Stats Grid - Now with 4 columns for Desktop */}
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                {/* Income Card (Only relevant in Month view basically, but we show current month setting) */}
                <StatCard 
                    title="Monthly Income" 
                    value={formatCurrency(currentMonthlyIncomeData.amount)}
                    note={currentMonthlyIncomeData.note}
                    icon={DollarSign} 
                    colorClass="text-emerald-600"
                    valueColorClass="text-emerald-700"
                    action={
                        <button 
                            onClick={() => setIsBudgetModalOpen(true)}
                            className="p-2 rounded-full hover:bg-slate-100 text-slate-400 hover:text-emerald-600 transition-colors"
                            title="Edit Income"
                        >
                            <Edit2 size={16} />
                        </button>
                    }
                />
                
                <StatCard 
                    title="Total Expenses" 
                    value={formatCurrency(totalExpenses)} 
                    icon={Wallet} 
                    colorClass="text-orange-600"
                    valueColorClass="text-orange-700"
                />

                <StatCard 
                    title="Current Balance" 
                    value={formatCurrency(currentBalance)} 
                    icon={CreditCard} 
                    colorClass={currentBalance >= 0 ? "text-green-600" : "text-red-600"}
                    valueColorClass={currentBalance >= 0 ? "text-green-700" : "text-red-600"}
                />

                <StatCard 
                    title="Top Category" 
                    value={(Object.entries(categoryTotals).sort((a, b) => b[1] - a[1])[0] || [])[0] || "-"} 
                    icon={TrendingUp} 
                    colorClass="text-purple-600"
                    valueColorClass="text-slate-800"
                />
              </div>

              <div className="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <div className="lg:col-span-2 glass-card rounded-3xl p-8 relative overflow-hidden">
                    <div className="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"></div>
                    <div className="flex items-center justify-between mb-8">
                        <h3 className="font-bold text-xl text-slate-800 flex items-center gap-3">
                            <div className="bg-indigo-100 p-2 rounded-xl text-indigo-600">
                                <PieChart size={20} />
                            </div>
                            Category Breakdown
                        </h3>
                    </div>
                  
                  {totalExpenses === 0 ? (
                     <div className="flex flex-col items-center justify-center py-16 text-center">
                        <div className="bg-slate-50 p-6 rounded-full mb-4 shadow-inner">
                            <Search className="text-slate-300" size={28} />
                        </div>
                        <p className="text-slate-500 font-medium">No expenses recorded yet.</p>
                        <button onClick={() => setActiveTab('add')} className="mt-6 text-sm font-bold text-white bg-indigo-600 px-6 py-3 rounded-xl shadow-lg shadow-indigo-500/30 hover:bg-indigo-700 hover:scale-105 transition-all">
                            Add your first expense &rarr;
                        </button>
                     </div>
                  ) : (
                    <div className="space-y-2">
                      {Object.entries(categoryTotals)
                        .sort(([,a], [,b]) => b - a)
                        .filter(([,amt]) => amt > 0)
                        .map(([cat, amt]) => (
                          <CategoryBar key={cat} category={cat} amount={amt} total={totalExpenses} config={CATEGORIES[cat]} />
                        ))}
                    </div>
                  )}
                </div>

                <div className="glass-card rounded-3xl p-8 flex flex-col justify-between relative overflow-hidden group text-white bg-gradient-to-br from-slate-800 to-slate-900 border-slate-700">
                    {/* Decorative background elements */}
                    <div className="absolute top-0 right-0 w-40 h-40 bg-indigo-500/20 rounded-full blur-3xl -mr-10 -mt-10 group-hover:scale-125 transition-transform duration-700"></div>
                    <div className="absolute bottom-0 left-0 w-32 h-32 bg-purple-500/20 rounded-full blur-2xl -ml-8 -mb-8"></div>
                    
                    <div className="relative z-10">
                        <div className="bg-white/10 backdrop-blur-md p-4 rounded-2xl w-16 h-16 flex items-center justify-center mb-6 border border-white/10 shadow-lg">
                            <PlusCircle size={32} className="text-indigo-300" />
                        </div>
                        <h3 className="text-2xl font-black mb-2 tracking-tight">Quick Add</h3>
                        <p className="text-slate-300 text-sm font-medium leading-relaxed opacity-90">Log a new expense immediately to keep your records up to date.</p>
                    </div>
                    <button 
                        onClick={() => setActiveTab('add')}
                        className="relative z-10 w-full py-4 bg-white text-slate-900 font-extrabold rounded-2xl hover:bg-indigo-50 transition-all shadow-lg mt-8 group-hover:-translate-y-1"
                    >
                        Add Expense
                    </button>
                </div>
              </div>
            </div>
          );

          const renderAddExpense = () => (
            <div className="max-w-2xl mx-auto glass-card rounded-3xl p-8 md:p-10 animate-fade-in mt-8 relative overflow-hidden">
              <div className="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"></div>
              
              <h2 className="text-3xl font-black text-slate-800 mb-8 flex items-center gap-3">
                <div className="bg-indigo-100 text-indigo-600 p-2.5 rounded-2xl">
                    <PlusCircle size={28} />
                </div>
                New Expense
              </h2>
              
              <form onSubmit={handleAddExpense} className="space-y-8">
                <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                  <div className="space-y-3">
                    <label className="text-xs font-bold text-slate-500 uppercase tracking-wider ml-1">Date</label>
                    <div className="relative group">
                        <div className="absolute left-4 top-3.5 text-indigo-400 group-focus-within:text-indigo-600 transition-colors">
                            <CalendarIcon size={20}/>
                        </div>
                        <input 
                            type="date" 
                            required
                            value={date}
                            onChange={(e) => setDate(e.target.value)}
                            className="w-full pl-12 pr-4 py-3.5 rounded-2xl glass-input border-transparent focus:bg-white focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 outline-none transition-all font-bold text-slate-700 shadow-sm"
                        />
                    </div>
                  </div>

                  <div className="space-y-3">
                    <label className="text-xs font-bold text-slate-500 uppercase tracking-wider ml-1">Amount</label>
                    <div className="relative group">
                        <span className="absolute left-4 top-3.5 text-indigo-400 font-black text-lg group-focus-within:text-indigo-600 transition-colors">₹</span>
                        <input 
                            type="number" 
                            required
                            min="0"
                            step="0.01"
                            placeholder="0.00"
                            value={amount}
                            onChange={(e) => setAmount(e.target.value)}
                            className="w-full pl-10 pr-4 py-3.5 rounded-2xl glass-input border-transparent focus:bg-white focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 outline-none transition-all text-lg font-bold text-slate-800 shadow-sm placeholder:text-slate-300"
                        />
                    </div>
                  </div>
                </div>

                <div className="space-y-3">
                  <label className="text-xs font-bold text-slate-500 uppercase tracking-wider ml-1">Category</label>
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                    {Object.keys(CATEGORIES).map((cat) => {
                      const Icon = CATEGORIES[cat].icon;
                      const isSelected = category === cat;
                      return (
                        <button
                          key={cat}
                          type="button"
                          onClick={() => setCategory(cat)}
                          className={`flex flex-col items-center justify-center p-4 rounded-2xl border-2 transition-all duration-200 group ${
                            isSelected 
                              ? 'bg-indigo-50/80 border-indigo-500 text-indigo-700 shadow-md shadow-indigo-200 scale-105' 
                              : 'border-transparent bg-white/50 hover:bg-white hover:border-indigo-200 text-slate-500 hover:shadow-md'
                          }`}
                        >
                          <Icon size={24} className={`mb-2 transition-transform group-hover:-translate-y-1 ${isSelected ? 'stroke-[2.5px]' : ''}`} />
                          <span className={`text-xs font-bold ${isSelected ? 'text-indigo-900' : ''}`}>{cat}</span>
                        </button>
                      )
                    })}
                  </div>
                </div>

                <div className="space-y-3">
                  <label className="text-xs font-bold text-slate-500 uppercase tracking-wider ml-1">Remarks <span className="text-slate-400 font-medium normal-case">(Optional)</span></label>
                  <textarea 
                    rows="3"
                    value={remarks}
                    onChange={(e) => setRemarks(e.target.value)}
                    className="w-full px-5 py-4 rounded-2xl glass-input border-transparent focus:bg-white focus:ring-4 focus:ring-indigo-100 focus:border-indigo-500 outline-none transition-all resize-none font-medium text-slate-600 shadow-sm"
                    placeholder="E.g. Lunch at the new cafe..."
                  ></textarea>
                </div>

                <div className="pt-6">
                  <button 
                    type="submit" 
                    className="w-full py-4 bg-gradient-to-r from-indigo-600 to-violet-600 text-white font-extrabold text-lg rounded-2xl shadow-xl shadow-indigo-500/30 hover:shadow-2xl hover:scale-[1.02] active:scale-[0.98] transition-all"
                  >
                    Save Transaction
                  </button>
                </div>
              </form>
            </div>
          );

          const renderHistory = () => (
            <div className="space-y-8 animate-fade-in max-w-5xl mx-auto mt-6">
              <div className="flex flex-col xl:flex-row md:items-center justify-between gap-8 glass-card p-8 rounded-3xl relative z-20">
                <div className="flex items-center gap-4">
                  <div className="bg-indigo-50 p-3 rounded-2xl text-indigo-600 shadow-sm">
                     <Filter size={24}/>
                  </div>
                  <div>
                      <h2 className="text-xl font-black text-slate-900">History</h2>
                      <p className="text-sm text-slate-500 font-medium">Filter and manage records</p>
                  </div>
                </div>

                <div className="flex flex-col md:flex-row gap-4 items-start md:items-center flex-wrap">
                   <PeriodSelector 
                       viewMode={viewMode} 
                       setViewMode={setViewMode}
                       selectedMonth={selectedMonth} 
                       setSelectedMonth={setSelectedMonth}
                       dateRange={dateRange}
                       setDateRange={setDateRange}
                   />
                   
                   {/* Sort Dropdown */}
                   <div className="relative w-full md:w-auto group">
                        <div className="absolute left-3 top-2.5 text-indigo-500 pointer-events-none">
                            <ArrowUpDown size={16} />
                        </div>
                        <select 
                            value={sortBy}
                            onChange={(e) => setSortBy(e.target.value)}
                            className="w-full md:w-auto pl-10 pr-8 py-2.5 rounded-2xl glass-input text-sm font-bold text-slate-700 shadow-sm ring-1 ring-black/5 hover:bg-white hover:ring-indigo-200 hover:shadow-md transition-all appearance-none cursor-pointer outline-none min-w-[160px]"
                        >
                            <option value="date-desc">Newest First</option>
                            <option value="date-asc">Oldest First</option>
                            <option value="amount-desc">Highest Amount</option>
                            <option value="amount-asc">Lowest Amount</option>
                        </select>
                        <div className="absolute right-3 top-2.5 text-slate-400 pointer-events-none">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                        </div>
                   </div>

                   <MultiSelect 
                       options={Object.keys(CATEGORIES)} 
                       selected={filterCategories} 
                       onChange={setFilterCategories} 
                   />
                </div>
              </div>

              {filteredHistoryExpenses.length === 0 ? (
                <div className="text-center py-20 glass-card rounded-3xl border-dashed border-2 border-slate-300/50">
                    <div className="mx-auto w-16 h-16 bg-slate-100 rounded-full flex items-center justify-center mb-4 shadow-inner">
                        <Search className="text-slate-400" size={28}/>
                    </div>
                    <p className="text-slate-500 font-bold">No transactions found.</p>
                    <p className="text-slate-400 text-sm mt-1">Try adjusting your filters.</p>
                </div>
              ) : (
                <div className="space-y-4">
                  {filteredHistoryExpenses.map((expense) => {
                    const CatConfig = CATEGORIES[expense.category] || CATEGORIES['Miscellaneous'];
                    const CatIcon = CatConfig.icon;

                    return (
                      <div 
                        key={expense.id} 
                        className="glass-card p-5 rounded-2xl hover:bg-white/80 hover:border-indigo-200 transition-all duration-300 flex flex-col sm:flex-row sm:items-center justify-between gap-4 group hover:shadow-lg hover:-translate-y-0.5 cursor-default"
                      >
                        <div className="flex items-start space-x-5">
                          <div className={`p-3 rounded-xl shrink-0 ${CatConfig.color} shadow-sm group-hover:scale-110 transition-transform duration-300`}>
                            <CatIcon size={20} strokeWidth={2.5} />
                          </div>
                          <div>
                            <div className="flex items-center gap-3 mb-1">
                                <h4 className="font-bold text-slate-800 text-lg">{expense.category}</h4>
                                <span className="text-[10px] font-bold text-slate-500 px-2 py-0.5 bg-slate-100 rounded-full uppercase tracking-wide">
                                    {new Date(expense.date).toLocaleDateString(undefined, { day: 'numeric', month: 'short' })}
                                </span>
                            </div>
                            <p className="text-sm text-slate-500 font-medium">
                                {expense.remarks || <span className="italic opacity-60">No remarks</span>}
                            </p>
                            {expense.lastEdited && (
                              <p className="text-[10px] text-slate-400 mt-1.5 font-medium flex items-center gap-1.5">
                                <span className="w-1.5 h-1.5 bg-indigo-400 rounded-full"></span>
                                Edited: {new Date(expense.lastEdited).toLocaleString(undefined, { month: 'short', day: 'numeric', hour: 'numeric', minute: '2-digit' })}
                              </p>
                            )}
                          </div>
                        </div>
                        
                        <div className="flex items-center justify-between sm:justify-end w-full sm:w-auto gap-4 pl-14 sm:pl-0 border-t sm:border-0 border-slate-100 pt-4 sm:pt-0">
                            <span className="font-black text-xl text-slate-800 tabular-nums tracking-tight mr-2">
                                {formatCurrency(expense.amount)}
                            </span>
                            <div className="flex items-center gap-2">
                                <button 
                                    onClick={() => setEditingTransaction(expense)}
                                    className="p-2.5 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded-xl transition-all opacity-0 group-hover:opacity-100 focus:opacity-100 scale-90 hover:scale-100"
                                    title="Edit Entry"
                                >
                                    <Edit2 size={18} />
                                </button>
                                <button 
                                    onClick={() => handleDelete(expense.id)}
                                    className="p-2.5 text-slate-400 hover:text-rose-600 hover:bg-rose-50 rounded-xl transition-all opacity-0 group-hover:opacity-100 focus:opacity-100 scale-90 hover:scale-100"
                                    title="Delete Entry"
                                >
                                    <Trash2 size={18} />
                                </button>
                            </div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              )}
            </div>
          );

          return (
            <div className="min-h-screen pb-28 md:pb-12">
              <header className="bg-white/70 backdrop-blur-xl border-b border-white/20 sticky top-0 z-40 shadow-sm supports-[backdrop-filter]:bg-white/60">
                <div className="max-w-5xl mx-auto px-4 h-20 flex items-center justify-between">
                  <div className="flex items-center gap-3 cursor-pointer group" onClick={() => setActiveTab('dashboard')}>
                    <div className="bg-gradient-to-tr from-slate-800 to-slate-900 p-2.5 rounded-xl shadow-lg shadow-slate-900/20 group-hover:scale-105 transition-transform">
                        <Wallet className="text-white" size={20} strokeWidth={2.5} />
                    </div>
                    <h1 className="text-xl font-black text-slate-900 tracking-tight">Expenses<span className="text-indigo-600 font-medium">Tracker</span></h1>
                  </div>

                  {/* Desktop Navigation */}
                  <nav className="hidden md:flex items-center gap-1 bg-slate-100/50 p-1.5 rounded-2xl border border-white/50 backdrop-blur-sm">
                    <button
                        onClick={() => setActiveTab('dashboard')}
                        className={`px-6 py-2.5 rounded-xl text-sm font-bold transition-all duration-300 ${
                            activeTab === 'dashboard'
                            ? 'bg-white text-indigo-600 shadow-sm ring-1 ring-black/5'
                            : 'text-slate-500 hover:text-slate-800 hover:bg-white/60'
                        }`}
                    >
                        Overview
                    </button>
                    <button
                        onClick={() => setActiveTab('history')}
                        className={`px-6 py-2.5 rounded-xl text-sm font-bold transition-all duration-300 ${
                            activeTab === 'history'
                            ? 'bg-white text-indigo-600 shadow-sm ring-1 ring-black/5'
                            : 'text-slate-500 hover:text-slate-800 hover:bg-white/60'
                        }`}
                    >
                        History
                    </button>
                    <button
                        onClick={() => setActiveTab('add')}
                        className={`px-6 py-2.5 rounded-xl text-sm font-bold transition-all duration-300 flex items-center gap-2 ${
                            activeTab === 'add'
                            ? 'bg-indigo-600 text-white shadow-lg shadow-indigo-500/30'
                            : 'text-slate-500 hover:text-slate-800 hover:bg-white/60'
                        }`}
                    >
                        {activeTab !== 'add' && <PlusCircle size={16} strokeWidth={3} />}
                        Add
                    </button>
                  </nav>

                  <div className="hidden md:flex items-center gap-6">
                    <div className="text-right">
                        <p className="text-[10px] font-black text-indigo-400 uppercase tracking-widest">Today</p>
                        <p className="text-sm font-bold text-slate-700">{new Date().toLocaleDateString('en-US', { weekday: 'short', day: 'numeric', month: 'short' })}</p>
                    </div>
                  </div>
                </div>
              </header>

              <main className="max-w-5xl mx-auto px-4 py-10 relative z-10">
                {activeTab === 'dashboard' && renderDashboard()}
                {activeTab === 'add' && renderAddExpense()}
                {activeTab === 'history' && renderHistory()}
              </main>

              {/* Modals */}
              <BudgetModal 
                isOpen={isBudgetModalOpen}
                onClose={() => setIsBudgetModalOpen(false)}
                month={selectedMonth}
                currentBudget={currentMonthlyIncomeData.amount || ''}
                currentNote={currentMonthlyIncomeData.note || ''}
                onSave={handleSaveBudget}
              />

              <EditExpenseModal
                isOpen={!!editingTransaction}
                onClose={() => setEditingTransaction(null)}
                expense={editingTransaction}
                onSave={handleUpdateExpense}
              />

              {/* Mobile Nav */}
              <nav className="md:hidden fixed bottom-0 w-full bg-white/80 backdrop-blur-xl border-t border-white/20 pb-safe z-50 shadow-[0_-10px_20px_-5px_rgba(0,0,0,0.05)]">
                <div className="flex justify-around items-center h-20 px-2">
                    {[
                        { id: 'dashboard', icon: LayoutDashboard, label: 'Overview' },
                        { id: 'add', icon: PlusCircle, label: 'Add' },
                        { id: 'history', icon: Filter, label: 'History' }
                    ].map(item => (
                        <button 
                            key={item.id}
                            onClick={() => setActiveTab(item.id)}
                            className={`flex flex-col items-center gap-1.5 w-20 rounded-2xl py-2 transition-all duration-300 ${
                                activeTab === item.id 
                                ? 'text-indigo-600 -translate-y-2 bg-white shadow-lg shadow-indigo-100' 
                                : 'text-slate-400 hover:text-slate-600'
                            }`}
                        >
                            <item.icon size={item.id === 'add' ? 26 : 22} strokeWidth={activeTab === item.id ? 2.5 : 2} />
                            <span className={`text-[10px] font-bold ${activeTab === item.id ? 'opacity-100' : 'opacity-0 h-0'}`}>{item.label}</span>
                        </button>
                    ))}
                </div>
              </nav>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>